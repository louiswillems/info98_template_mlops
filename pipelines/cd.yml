name: CD

on:
  workflow_dispatch:
  push:
    branches:
      - 'main'

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: prd # Cible directe de l'environnement de production
    permissions:
      contents: write # Nécessaire pour git tag

    env:
      DATABRICKS_HOST: ${{ vars.DATABRICKS_HOST }}
      DATABRICKS_TARGET_TOKEN: ${{ secrets.DATABRICKS_TARGET_TOKEN }}

    steps:
      - name: Checkout Source Code
        uses: actions/checkout@v4

      - name: Install Databricks CLI
        uses: databricks/setup-cli@v0.246.0

      - name: Install uv
        uses: astral-sh/setup-uv@v5

      - name: Deploy to Databricks (Production)
        run: |
          # J'ai remplacé la variable matrix par "prod" en dur
          databricks bundle deploy -t prod
